{% extends 'base5.html' %}

{% block title %}Find a Partner - Language Learning Platform{% endblock %}

{% block profile_image %}
    {% if user.profile.avatar %}
        {% url 'group5:serve_avatar' user.profile.avatar.name|slice:'21:' %}
    {% else %}
        https://placehold.co/144x144/6366f1/FFFFFF?text={{ user.profile.firstname|first|upper|default:"User" }}
    {% endif %}
{% endblock %}

{% block style %}
    /* Custom scrollbar for the user list for a better look */
    .user-list::-webkit-scrollbar {
        width: 6px;
    }
    .user-list::-webkit-scrollbar-track {
        background: transparent;
    }
    .user-list::-webkit-scrollbar-thumb {
        background-color: rgba(255, 255, 255, 0.2);
        border-radius: 20px;
    }
    .user-list::-webkit-scrollbar-thumb:hover {
        background-color: rgba(255, 255, 255, 0.4);
    }
{% endblock %}

{% block content %}
<div class="flex flex-col h-full space-y-8">

    <div class="glass-card rounded-2xl p-6">
        <h1 class="text-3xl font-bold text-white">Language Learning Platform</h1>
        <p class="text-gray-300 mt-2">Find language learning partners and customize your learning preferences</p>
    </div>
    <form id="interests-form" method="get" action="{% url 'group5:search_users' %}">

        <div class="glass-card rounded-2xl p-6">
            <h2 class="text-2xl font-bold text-white mb-6">Learning interests</h2>
                <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                    {% for key, label in learning_choices %}
                        <label class="flex items-center p-3 rounded-lg bg-white/5 hover:bg-white/15 cursor-pointer transition">
                            <input type="checkbox" name="interest" value="{{ key }}"
                                class="h-5 w-5 rounded bg-gray-700 border-gray-600 text-indigo-500 focus:ring-indigo-500 focus:ring-offset-0"
                                {% if key in selected_interests %}checked{% endif %}>
                                <span class="ml-3 text-white select-none">{{ label }}</span>
                        </label>
                    {% endfor %}
                </div>
        </div>

        <div class="glass-card rounded-2xl p-6 mt-6">
            <h2 class="text-2xl font-bold text-white mb-4">Search for</h2>
            
            <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-3">
                <div class="relative flex-1">
                    <span class="absolute inset-y-0 left-0 flex items-center pl-4 text-gray-400">
                        <i class="fas fa-search"></i>
                    </span>
                    <input type="search" name="q" value="{{ query|default:'' }}"
                        class="w-full py-3 pl-12 pr-4 bg-black/20 text-white rounded-lg border border-transparent focus:border-indigo-500 focus:ring-indigo-500 transition"
                        placeholder="User search...">
                </div>
        
                <button type="submit"
                    class="py-3 px-6 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-lg transition">
                    جستجو
                </button>
            </div>
        </div>
        
    </form>
        

    <div>
        {# The user count is now accurate and simple. #}
        <h2 class="text-2xl font-bold text-white mb-4">User Profiles ({{ profiles|length }} found)</h2>
        <div class="space-y-6 user-list">
            
            {% for partner in profiles %}
            <div class="glass-card rounded-2xl p-6">
                <a href="{% url 'group5:user_profile' partner.user.username %}">
                    <h3 class="text-xl font-bold text-white mb-4">{{ partner.firstname }} {{ partner.lastname }}</h3>
                </a>
                <div class="space-y-3 text-gray-300 border-b border-white/10 pb-4">
                    <p><i class="fas fa-envelope fa-fw mr-2 text-gray-400"></i>{{ partner.user.email|default:"Not set" }}</p>
                    <p><i class="fas fa-map-marker-alt fa-fw mr-2 text-gray-400"></i>{{ partner.location|default:'Not specified' }}</p>
                    <div class="flex flex-wrap items-center">
                        <i class="fas fa-user fa-fw mr-2 text-gray-400"></i> {{ partner.age }} years old
                        <span class="mx-3 text-gray-500">·</span>
                        <i class="fas fa-venus-mars fa-fw mr-1 text-gray-400"></i> {{ partner.gender|default:'Not specified' }}
                    </div>
                </div>
                
                <p class="mt-4 text-gray-200 bg-black/10 p-3 rounded-lg border-l-4 border-indigo-400 italic">
                    "{{ partner.bio|default:'No bio provided.' }}"
                </p>

                <div class="mt-5">
                    <h4 class="font-semibold text-white mb-3">Interests</h4>
                    <div class="flex flex-wrap gap-2">
                        {% for interest in partner.learning_interest %}
                        <span class="bg-gray-700/50 text-gray-200 text-sm font-medium py-1 px-3 rounded-full">{{ interest }}</span>
                        {% empty %}
                        <p class="text-gray-400 italic text-sm">No interests listed.</p>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="glass-card rounded-2xl p-8 text-center">
                <i class="fas fa-user-slash fa-3x text-gray-400 mb-4"></i>
                <h3 class="text-xl font-bold text-white">No Users Found</h3>
                <p class="text-gray-300 mt-2">Try adjusting your search query or filters.</p>
            </div>
            {% endfor %}
            
        </div>
    </div>
</div>
{% endblock %}